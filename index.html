<!DOCTYPE HTML>
<!--
	Read Only by HTML5 UP
	html5up.net | @ajlkn
	Free for personal and commercial use under the CCA 3.0 license (html5up.net/license)
-->
<html>
	<head>
		<title>Social Data - Final Project</title>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
		<link rel="stylesheet" href="assets/css/main.css" />
		<link rel="icon" href="images/favicon.ico">
	</head>
	<body class="is-preload">

		<!-- Header -->
			<section id="header">
				<header>
					<h1 id="logo"><a href="#">Social Data - Final Project</a></h1>
					<div id="titleBar">
				</header>
				<nav id="nav">
					<ul>
						<li><a href="#about" class="active">About</a></li>
						<li><a href="#data">The Data</a></li>
						<li><a href="#dataAnalysis">Data Analysis</a></li>
						<li><a href="#conclusion">Conclusion</a></li>
						<li><a href="#code">Code</a></li>
					</ul>
				</nav>
				<!--
				<footer>
					<ul class="icons">
						<li><a href="#" class="icon brands fa-twitter"><span class="label">Twitter</span></a></li>
						<li><a href="#" class="icon brands fa-facebook-f"><span class="label">Facebook</span></a></li>
						<li><a href="#" class="icon brands fa-instagram"><span class="label">Instagram</span></a></li>
						<li><a href="#" class="icon brands fa-github"><span class="label">Github</span></a></li>
						<li><a href="#" class="icon solid fa-envelope"><span class="label">Email</span></a></li>
					</ul>
				</footer>
				-->
			</section>

		<!-- Wrapper -->
			<div id="wrapper">

				<!-- Main -->
					<div id="main">

						<!-- One -->
							<section id="about">
								<div class="image main" data-position="center">
									<img src="images/bike.jpeg" alt="" />
								</div>
								<div class="container">
									<header class="major">
										<h2>Effects of Weather on Traffic in Copenhagen</h2>
										<div>
											<h3>Introduction</h3>
											<p>
												The people of Copenhagen love their bicycles. Combined, they cycle over a million kilometers every single day <a href="https://web.archive.org/web/20190707123514/https://www.kk.dk/indhold/62-af-koebenhavnerne-cykler-til-arbejde-og-uddannelse" target="blank">[1]</a>. And it shouldn't come as a surprise, as the city is the capital of the fourth flattest country in the world - with an average elevation of just 34 meters <a href="https://www.worldatlas.com/articles/countries-with-the-lowest-average-elevations.html" target="blank">[2]</a> - making it the perfect country for cyclists. Cycling is very much encouraged in the city, with around 350 km of cycle tracks, and more to be added in the coming years <a href="https://web.archive.org/web/20121008210710/http://kk.dk/PolitikOgIndflydelse/OekonomiOgBudget/Budgetter/~/media/03A8C61E76C8482BBF875732644B186F.ashx" target="blank">[3]</a>. 
											</p>
											<p>
												We are interested in investigating just how committed Danes are to their cycling. We have gathered data on counts of bicycles and cars from a number of counting posts in the city from 2012-2014. Additionally, we have gathered data about the weather from that time, and want to combine those two datasets to find out whether the weather - and more so, which weather conditions - affect the traffic of both bikes and cars. Are there fewer bicycles and more cars when there's rain or high winds? Likewise, are people liklier to hop on their bikes and leave the car at home when the temperature is high?
											</p>
											<p>
												For those interested, the code with the analysis can be found on the <a href="#code">bottom</a> of this page.
											</p>
										</div>
									</header>
								</div>
							</section>

						<!-- Two -->
							<section id="data">
								<div class="container">
									<h3>The Data</h3>
										<p>
											The traffic data is gathered from <a href="https://www.opendata.dk/city-of-copenhagen/faste-cykeltaellinger?fbclid=IwAR2s1HKWtWFHXUEuayvwQKqnvHqykKManJZn1ALWgLXtMGKfuNpqR8N2yBE" target="blank">Københavns Kommune</a>.
											<br><br>
											The traffic numbers are collected from counting posts located on various streets and bicycle routes around the city of Copenhagen. There are data from nine counters on bicycle routes, and from 14 posts on streets counting cars. The data is from the years 2012, 2013 and 2014 and is ordered by date and hour. The interactive map below shows the locations of the counting posts.
											</p>
											<div class="iframewrapper ">
											<iframe width="800" height="450" src="map.html" frameborder="0" allowfullscreen></iframe>
											</div>
											<br><br>
											We start by investigating the data to get better overview of it. In the figure below we have a boxplot of the bicycle data. It shows the distribution of the number of bicycles per day each year. We can see that 2013 has the most significant outlier indicating the busiest day for the entire data. We can also see that 2012 has the highest mean and 2013 has the lowest. But we can see that the distribution is rather similar for all the years, thus we can interpret that the bike traffic is not increasing or decreasing over the years.  
								            <br><br>
											<div id="slope" class="image">
												<img src="images/box_bike.png" alt="Box bike" width="100%">
											</div>
											<br><br>
											<p>Now we do the same for the car data, the boxplot below shows the distribution of the number of cars per day each year.  Overall we can conclude that the car data is evenly distributed over the three years of measurements, the statistical difference is insignificant in between years.</p>
											<div id="slope" class="image">
												<img src="images/box_car.png" alt="Box car" width="100%">
											</div>
											<br><br>
											We collected the weather data from the <a href="https://www.visualcrossing.com/weather/weather-data-services" target="blank">Visual Crossing Weather API</a>. It contains information about the weather for each day over the three years. The weather data consists of information about precipitation, temperature, windspeed and wind direction, UV index and humidity among other things. 
											<br><br>
											To get a better overview of the weather data we create a heat map for precipitation, tempature and wind on 2014. Here below we can see the heat maps and how the weather was in the year of 2014. 
											<div id="slope" class="image">
												<img src="images/precip2014.png" alt="Percip" width="100%">
											</div>
											<div id="slope" class="image">
												<img src="images/temp2014.png" alt="Temp" width="100%">
											</div>
											<div id="slope" class="image">
												<img src="images/wind2014.png" alt="Wind" width="100%">
											</div>

											Our plan is to concatenate these two datasets and analyse them to get a deeper understanding of the traffic in Copenhagen, and try to predict the traffic based on the various factors in our data. 
								</div>
							</section>

						<!-- Three -->
							<section id="dataAnalysis">
								<div class="container">
									<h3>Data analysis</h3>
									<article>
										<h4>Temporal Traffic Patterns and Weather Affects</h4>
										<p>
											Let's start our analysis by inspecting the temporal patterns in the data. We are interested in seeing how the traffic changes during the day, during the week and during the whole year. The interactive chart below shows these patterns. Navigate through the charts by using the tabs above the chart. 
										</p>
										<div class="iframewrapper ">
											<iframe width="850" height="550px" src="temp_patt.html" frameborder="0" allowfullscreen></iframe>
										</div>
										<p>
											The first graph shows the average number of cars and bikes that were counted during each hour of the day. The number of cars is considerably higher than the number of bikes, and the number of cars and bikes is expectedly much less in the nighttime than in the daytime. We see notable peaks in the bike numbers between 8 and 9 AM, and between 4 and 5 PM, while the car traffic is pretty much rising the whole day until it reaches its peak between 3 and 4 PM. 
										</p>
										<p>
											In the weekly data, the distributions of car and bike traffic are very similar, with pretty uniform numbers in the weekdays, and significantly lower during the weekends.
										</p>
										<p>
											The monthly pattern doesn't really offer any interesting insights, there is less traffic in July compared to the surrounding months. December is also less busy on the road.
										</p>
										<p>
											Now we are interested in seeing the count of cars and bikes under certain weather conditions. Let us look at the numbers in hot weather, high windspeed and wet weather. We define hot weather as temperature over 16°C, high windspeed as windspeed over 40m/s, and wet weather as days with some rain. The interactive chart below shows a visualisation of those numbers. Note the difference in the y-axes.
										</p>
										<div class="iframewrapper ">
											<iframe width="850" height="550px" src="weather_bokeh.html" frameborder="0" allowfullscreen></iframe>
										</div>
									</article>
									<article>
										<div class="text">
											<h4>Difference between traffic in different weather conditions</h4>
											<p>
												We can now showcase the difference in car and bike count in high and low precipitation, windspeed and temperature. By splitting the data by precipitation or no precipitation, windspeed over 40m/s and under 40m/s and temperatures either side of 16°C, we can show the difference in the average count with a slope plot.
											</p>
											<div id="slope" class="image">
												<img src="images/slope_chart.png" alt="Slope Chart" width="100%">
											</div>
											<p>
												The slope chart shows how the number of cars and bikes differs according to different weather conditions. We can see that our data suggests that the car traffic decreases with higher precipitation, windspeed and temperature. Unsurprisingly, the number of bikes counted is lower when there is high windspeed and precipitation, but higher when the temperature is higher.
											</p>
											<p>
												The question is then: Can we conclude, using this data, that these results are reliable? Is the difference in traffic between weather conditions maybe due to other factors? Applying a t-test on the data, we can determine if the difference is in fact significant, and not due to a chance or other reasons. This gives us the results that there is actually not a statistically significant difference between the number of cars in high and low windspeed and temperature, while there is significant difference between the car traffic in low precipitation and high precipitation. On the contrary, for the bicycle traffic, there is in fact a significant difference between the traffic numbers in high and low precipitation, windspeed and temperature. The people of Copenhagen are understandably more excited to ride their bikes to work or school if the weather is nice. The number of cars also goes down when it's raining, so it looks like people are just less likely to go out when it's raining. If seems strange though that the inhabitants of Copenhagen are not fond of rain - according to our data, there is some rain on two thirds of the days there.
											</p>
											<p>
												Now that we have shown the difference due to weather conditions, we are interested in building a model to predict the traffic flow of both cars and bikes, using methods of machine learning.
											</p>
										</div>
									</article>
									<article>
										<div>
											<h4>Predicting bike traffic and important features.</h4>
											<p>Lastly we are interested in see if we can train a machine learning model that predicts the bike traffic for each station. First we choose the features we want as an input to our model, we want to make prediction based on location, month, day of the week and weather. The weather features we choose to use are temperature, what temperature it feels like, precipitation, wind speed and wind direction. To be able to make a good model we need to encode non-numerical features. That is day of week and the location of the station. For the weekdays Monday is represented as 0 and Sunday as 6. In table below be can see how the stations are encoded. </p>
										</div>
										<h4>Encoding of the location</h4>
										<div class="table-wrapper">
											<table>
												<thead>
													<tr>
														<th>Street name</th>
														<th>Encoding</th>
													</tr>
												</thead>
												<tbody>
													<tr>
														<td>Ellebjergvej</td>
														<td>0</td>
													</tr>
													<tr>
														<td>Fredensbro</td>
														<td>1</td>
													</tr>
													<tr>
														<td>Frederikssundsvej</td>
														<td>2</td>
													</tr>
													<tr>
														<td>Hareskovvej</td>
														<td>3</td>
													</tr>
													<tr>
														<td>Kalvebod Brygge</td>
														<td>4</td>
													</tr>
													<tr>
														<td>Roskildevej</td>
														<td>5</td>
													</tr>
													<tr>
														<td>Torvegade</td>
														<td>6</td>
													</tr>
													<tr>
														<td>Vigerslev Allé</td>
														<td>7</td>
													</tr>
													<tr>
														<td>Åboulevard</td>
														<td>8</td>
													</tr>
												</tbody>
											</table>
										</div>
										<div>
											<p>
												Next step is to find a model that fits out data and we see that it is a model based on decision trees. We can use a model like this to make predictions on bike traffic and also to give us more insights into what features are important when predicting bike traffic. In the figures below we can see the importance of features in our machine learning model. In the figure to the left we can see that the location or the name of the street the bikes are passing by is the far most important feature. In the figure to the right we can see the importance of other features. The second most important feature is the day of week. When looking at the weather feature feelslike is most important, from that we can interpret that depending on the tempature people feel has also some impact on if they decide to bike or not. 
											</p>
											<div id="imp" class="image_">
												<img src="images/feature_imp.png" alt="Feature importance" width="100%">
											</div>
										</div>	
										<div>
											<p>
												We are interested in looking even further into feature importance and we decide to use shapley values. They are a widely used approach from cooperative game theory that come with desirable properties and are useful when looking deeper into the feature importance of a model.  The shaply values give a very similar result to the feature importance values and in the figure below we can see the mean absolute shaply values of each feature.
											</p>
											<div class="image_">
												<img src="images/shaply_val.png" alt="">
											</div>
										</div>
										<div>
											<p>
												Here below we have a different representation for the shaply values <a href="https://shap.readthedocs.io/en/latest/example_notebooks/overviews/An%20introduction%20to%20explainable%20AI%20with%20Shapley%20values.html#additive_regression" target="blank"></a>. This figure is more informative. We have different shaply values for different values of each feature. For example we can see that for higher percip we have lower shap value which means that high percip lowers the number of bikes passing by. Also for the feels like feature we can see that for higher values we have more traffic.
											</p>
											<div class="image_">
												<img src="images/summary_val.png" alt="">
											</div>
										</div>
	
										<div>
											<p>
												Lastly we want to visualize how a new datapoint is predicted.Since our model is a random forest regressor and based on decision trees. First we get a random sample for our data, below is the visualization of the branch that the datapoint goes through when predicting its output. The data point we want to predict is at Frederikssundsvej on a tuesday in August. Where the tempature feels like 17.5°C and perciption is 1.2. This decision tree predicts from thease features that the number of bikes that will pass by at this location on a day like this is 3052.
											</p>
											<div class="image_">
												<img src="images/grein.svg" alt="">
											</div>
										</div>								
									</article>
									</div>
								</div>
							</section>

						<!-- Four -->
							<section id="conclusion">
								<div class="container">
									<h3>Conclusion</h3>
									<p> 
										We were interested in showing just how much they like it, and if anything could stop them from using bikes for commuting. Having investigated the data, we managed to show that the weather does indeed affect their willingness to commute by bicycle. There are significantly fewer bikes on the cycle tracks if it is raining, the wind is high or the temperature is low. On the contrary, it seems like people do not let the weather affect their usage of cars, except for when it rains, when there are actually fewer cars on the street. One might think that lower windspeed and higher temperature would encourage people to keep the car at home, but our data shows that isn't the case. It looks like people just like staying at home when it rains instead of going to work or school. Or maybe they just use other modes of transport. To find the reason, we would have to dig deeper, gather more data and continue our analysis.
									</p>
								</div>
							</section>
						<!-- Five -->
						<section id="code">
							<div class="container">
								<h3>Code</h3>
								<p> </p>
							</div>
						</section>
					</div>

				<!-- Footer -->
					<section id="footer">
						<div class="container">
							<p>
								Halla María Hjartardóttir - s212958 <br>
								Sigríður Þóra Halldórsdóttir - s212945 <br>
								Þórður Örn Stefánsson - s212957
							</p>
							<ul class="copyright">
								<li>&copy; Untitled. All rights reserved.</li><li>Design: <a href="http://html5up.net">HTML5 UP</a></li>
							</ul>
						</div>
					</section>

			</div>

		<!-- Scripts -->
			<script src="assets/js/jquery.min.js"></script>
			<script src="assets/js/jquery.scrollex.min.js"></script>
			<script src="assets/js/jquery.scrolly.min.js"></script>
			<script src="assets/js/browser.min.js"></script>
			<script src="assets/js/breakpoints.min.js"></script>
			<script src="assets/js/util.js"></script>
			<script src="assets/js/main.js"></script>

	</body>
</html>